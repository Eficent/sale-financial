<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Sale order -->
    <!-- Add markup rate of the order in form view after Compute button -->
    <record model="ir.ui.view" id="sale_markup_sale_order_view">
        <field name="name">sale.order.markup.view.form</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form" />
        <field name="arch" type="xml">
            <xpath expr="//group[@name='sale_total']" position="after">
                <group name="sale_markup"
                    groups="sales_team.group_sale_manager">
                    <field name="markup_rate"/>
                </group>
            </xpath>
        </field>
    </record>

    <!-- Add markup rate of the order in tree view after state field -->
    <record model="ir.ui.view" id="sale_markup_sale_order_tree">
        <field name="name">sale.order.markup.view.tree</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_tree"/>
        <field name="arch" type="xml">
            <field name="state" position="after">
            <field name="markup_rate"
                groups="sales_team.group_sale_manager"/>
            </field>
        </field>
    </record>

    <record model="ir.ui.view" id="sale_markup_sale_order_line_tree">
        <field name="name">sale.order.line.markup.view.tree</field>
        <field name="model">sale.order.line</field>
        <field name="inherit_id" ref="sale.view_order_line_tree"/>
        <field name="arch" type="xml">
            <field name="price_subtotal" position="after">
            <field name="commercial_margin"
                 groups="sales_team.group_sale_manager"/>
            <field name="markup_rate"
                 groups="sales_team.group_sale_manager"/>
        </field>
        </field>
    </record>


    <!-- Add Markup in Sales Orders form's Sale order lines form -->
    <record model="ir.ui.view" id="sale_markup_sale_order_form_line_form">
        <field name="name">sale.order.markup.view.form</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='order_line']/form//field[@name='name']"
                position="before">
                    <group string="Markup" groups="sales_team.group_sale_manager  ">
                        <field name="commercial_margin"
                        context="{'commercial_margin': commercial_margin, 'markup_rate': markup_rate, 'discount': discount, 'cost_price': cost_price, 'price_unit': price_unit}"
                        groups="sales_team.group_sale_manager"/>
                        <field name="markup_rate"
                        context="{'markup_rate': markup_rate, 'commercial_margin': commercial_margin, 'discount': discount, 'cost_price': cost_price, 'price_unit': price_unit}"
                        groups="sales_team.group_sale_manager"/>
                        <field name="cost_price"
                        groups="sales_team.group_sale_manager"
                        context="{'price_unit': price_unit, 'product_id': product_id, 'discount': discount, 'product_uom': product_uom, 'pricelist': parent.pricelist_id, 'markup_rate': markup_rate, 'commercial_margin': commercial_margin, 'cost_price': cost_price}"
                        />
                    </group>
                </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="view_order_form">
        <field name="name">sale.markup.view.order.form</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='order_line']/tree/field[@name='currency_id']" position="after">
                <field name="commercial_margin"
                    groups="sales_team.group_sale_manager"/>
                <field name="markup_rate"
                    groups="sales_team.group_sale_manager"/>
                <field name="cost_price"
                    groups="sales_team.group_sale_manager"/>
            </xpath>
        </field>
    </record>

     <!--Add Markup in Sales Orders form's Sale order lines tree-->
    <record model="ir.ui.view" id="sale_markup_sale_order_form_line_tree">
        <field name="name">sale.order.markup.view.form</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form" />
        <field name="arch" type="xml">
            <!--tree too large, not displayed correctly. removed editable-->
            <xpath expr="//field[@name='order_line']/tree" position="attributes">
                <attribute name="editable"/>
            </xpath>
            <xpath expr="//field[@name='order_line']/tree//field[@name='price_unit']"
                position="after">
            <field name="commercial_margin"
                context="{'commercial_margin': commercial_margin, 'markup_rate': markup_rate,
                'discount': discount, 'cost_price': cost_price, 'price_unit': price_unit}"
            groups="sales_team.group_sale_manager"/>
            <field name="markup_rate"
                context="{'markup_rate': markup_rate, 'commercial_margin': commercial_margin,
                'discount': discount, 'cost_price': cost_price, 'price_unit': price_unit}"
                groups="sales_team.group_sale_manager"/>
            <field name="cost_price"
                groups="sales_team.group_sale_manager"
                context="{'price_unit': price_unit, 'product_id': product_id, 'discount': discount,
                    'product_uom': product_uom, 'pricelist': parent.pricelist_id, 'markup_rate': markup_rate,
                    'commercial_margin': commercial_margin, 'cost_price': cost_price}"/>
            </xpath>
        </field>
    </record>

</odoo>
